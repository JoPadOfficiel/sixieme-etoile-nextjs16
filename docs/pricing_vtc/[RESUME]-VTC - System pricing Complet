# Whitepaper Technique : Architecture du Moteur de Pricing et de Dispatch Neural-Fleet V4

## 1.0 Introduction : La Rupture Ontologique dans la Mod√©lisation de la Mobilit√© de Luxe

L'industrie du transport de personnes √† haute valeur ajout√©e, particuli√®rement le segment du VTC de luxe, traverse une crise de mod√©lisation math√©matique sans pr√©c√©dent. Le paradigme historique, h√©rit√© de l'√®re du taxim√®tre et cristallis√© dans une √©quation lin√©aire simpliste `P(x) = D √ó R_d + T √ó R_t`, est aujourd'hui math√©matiquement obsol√®te pour op√©rer avec rentabilit√© dans des m√©tropoles complexes comme Paris. La volatilit√© des temps de trajet, la complexit√© topologique des zones urbaines et les imp√©ratifs de rentabilit√© d'une flotte distribu√©e exigent une refonte compl√®te de l'architecture de pricing.

Le projet Neural-Fleet V4 ne se contente pas d'une mise √† jour logicielle ; il marque une transition vers un "Syst√®me d'Exploitation Cognitif". Ce document d√©taille l'architecture de ce syst√®me, qui abandonne le d√©terminisme rigide des solutions h√©rit√©es pour embrasser une approche probabiliste et agentique. Nous d√©construirons ses m√©canismes selon quatre piliers fondamentaux : la topologie g√©ospatiale vectorielle, l'intelligence √©conomique ancr√©e dans le Co√ªt Total de Possession (TCO), la logistique distribu√©e par "Garages Virtuels", et l'orchestration par une escouade d'agents IA sp√©cialis√©s.

L'enjeu n'est plus simplement de calculer un prix, mais de r√©soudre un probl√®me d'optimisation multi-objectifs en temps r√©el. Il s'agit de maximiser la marge nette tout en garantissant une comp√©titivit√© face aux algorithmes agressifs des plateformes de "Ride-Hailing" et en respectant une "Cage de Fer" r√©glementaire stricte, assurant ainsi une rentabilit√© durable et une conformit√© sans faille.

## 2.0 Pilier I : La Topologie G√©ospatiale Vectorielle - Mod√©liser l'Espace √âconomique

La premi√®re axiomatique du moteur Neural-Fleet est la n√©gation de l'homog√©n√©it√© de l'espace. Dans le contexte parisien, un kilom√®tre parcouru sur le P√©riph√©rique √† 8h00 n'a pas la m√™me valeur √©conomique, √©nerg√©tique ou temporelle qu'un kilom√®tre sur autoroute √† 23h00. Il est donc strat√©gique de substituer la m√©trique euclidienne (distance pure) √† une m√©trique topologique qui capture la r√©alit√© √©conomique du terrain.

### 2.1 L'Architecture Topologique par Polygones

L'infrastructure g√©ospatiale repose sur une partition de l'espace de service \( \mathcal{S} \) en un ensemble fini de polygones \( \mathcal{Z} = \{Z_0, Z_1,..., Z_n\} \). Contrairement aux approches par rayon qui √©chouent √† capturer les fronti√®res naturelles et administratives, comme la barri√®re physique du P√©riph√©rique, l'approche polygonale permet une granularit√© chirurgicale et une mod√©lisation fid√®le des territoires √©conomiques.

Chaque zone est stock√©e sous forme d'objet GeoJSON dans une base de donn√©es spatiale PostGIS. Cette technologie permet d'ex√©cuter des requ√™tes d'appartenance Point-in-Polygon ultra-rapides, d√©terminant instantan√©ment la zone tarifaire d'une coordonn√©e GPS.

Nous identifions trois typologies de zones critiques pour le mod√®le √©conomique :

- **Z_0 (Le Noyau Dense)** : englobe Paris intra-muros et sa proche banlieue imm√©diate (ex : Aubervilliers). La logique de tarification y bascule vers une facturation au temps ou au forfait pour contrer l'effondrement de la vitesse commerciale.
- **Z_sat (Les Satellites Strat√©giques)** : n≈ìuds √©conomiques √† haute valeur (CDG, Orly, Le Bourget), souvent r√©gis par des grilles tarifaires fixes et contractuelles.
- **Z_friction (Les Zones √† Friction)** : zones g√©ographiquement proches mais op√©rationnellement co√ªteuses. Elles introduisent des co√ªts cach√©s non corr√©l√©s √† la distance et doivent √™tre int√©gr√©es explicitement au calcul de prix.

### 2.2 L'Algorithme de Calcul Hi√©rarchique et la Gestion de la Friction

Pour garantir la pr√©visibilit√© exig√©e par les contrats B2B tout en conservant une flexibilit√© algorithmique, le syst√®me n'utilise pas une simple matrice de co√ªts. Il emploie un algorithme de d√©cision hi√©rarchique qui √©value chaque trajet selon un ordre de priorit√© strict pour d√©terminer la m√©thode de calcul la plus appropri√©e :

1. **Priorit√© #1 (Trajet Intra-Zone Centrale)** : si d√©part et arriv√©e sont dans la zone centrale (Z_0), le syst√®me recherche un tarif forfaitaire d√©di√© (ex : `P(Z_Paris, Z_Paris) = 80‚Ç¨`).
2. **Priorit√© #2 (Route Forfaitaire D√©finie)** : si un forfait existe entre deux zones (ex : centre ‚Üî satellite), ce tarif pr√©vaut (ex : `P(Z_Paris, Z_CDG) = 90‚Ç¨`).
3. **Priorit√© #3 (Trajet Circulaire P√©riph√©rique)** : si le trajet est enti√®rement au sein d'une m√™me couronne, calcul dynamique distance/temps + multiplicateur de zone (priceMultiplier).
4. **Priorit√© #4 (Fallback Dynamique)** : √† d√©faut, calcul horokilom√©trique pur.

Versailles repr√©sente un cas d'√©cole de friction : toute intersection avec le polygone Z_Versailles applique un coefficient de friction \( C_f = 60‚Ç¨ \), somme de deux vecteurs de co√ªts :

- **C_park (Co√ªt Stationnaire)** : ~40‚Ç¨ (parking √©lev√© sur site).
- **C_access (Co√ªt Cin√©tique)** : ~20‚Ç¨ (complexit√© et temps d'acc√®s/sortie).

### 2.3 La D√©composition de Trajets Transversaux

Neural-Fleet analyse et d√©compose les trajets qui traversent des zones h√©t√©rog√®nes pour √©viter un calcul kilom√©trique na√Øf.

Exemple Versailles ‚Üí Disneyland Paris :

1. **Analyse d'Itin√©raire** : r√©cup√©ration de la polyligne via l'API Google Routes.
2. **D√©tection des Franchissements** : identification de l'intersection avec la zone centrale Z_0.
3. **D√©composition Logique** : segmentation en Versailles ‚Üí Paris et Paris ‚Üí Disneyland.
4. **Sommation de Forfaits** : interrogation de l'algorithme hi√©rarchique pour chaque segment et addition des forfaits `P(Versailles ‚Üí Paris) + P(Paris ‚Üí Disney)`.

### 2.4 La Bascule Dimensionnelle : Le "Time-Factor" dans le Noyau Dense

Dans le noyau dense (Z_0), la vitesse commerciale chute ; la facturation bascule en "Mise √† Disposition" (MAD) bas√©e sur le temps.

- Buckets temporels standards : `{4h, 5h, 6h, 8h, 10h, 12h, 14h}` (seuil minimal 4h, arrondi √† ce plancher).
- Interpolation pour dur√©es non standard (ex : 7h) : `P(7h) = (P(6h) + P(8h)) / 2`.
- Destinations encod√©es en forfaits temporels :
  - Normandie / Reims / Loire : vecteurs de 12h.
  - Mont-Saint-Michel : vecteur de 14h (distance extr√™me).

Cette topologie n'est efficace que si elle est ancr√©e dans une r√©alit√© de co√ªts : le pilier √©conomique.

## 3.0 Pilier II : Le Moteur √âconomique - Ancrage dans le Co√ªt Total de Possession (TCO)

Chaque d√©cision de pricing est valid√©e par rapport au co√ªt de revient r√©el de l'actif (TCO), prot√©geant l'entreprise de la vente √† perte.

### 3.1 Le Jumeau Num√©rique du V√©hicule

Chaque v√©hicule poss√®de un "Digital Twin" dynamique (pass√© : co√ªts d'achat/maintenance ; pr√©sent : t√©l√©m√©trie temps r√©el ; futur : d√©pr√©ciation pr√©dictive) permettant un co√ªt de revient pr√©cis. Les variations de co√ªts variables par cat√©gorie justifient un multiplicateur v√©hicule \( M\_{V√©hicule} \) (ex : un Van ‚âà 1.5√ó une berline).

| Cat√©gorie V√©hicule | Maintenance (‚Ç¨/km) | Risque D√©pr√©ciation |
| ------------------ | ------------------ | ------------------- |
| Berline (Classe E) | ~0,137 ‚Ç¨           | Standard            |
| Van (Classe V)     | ~0,171 ‚Ç¨           | Faible              |
| VIP (Classe S)     | ~0,342 ‚Ç¨           | Extr√™me             |

### 3.2 L'Algorithme de Calcul du Prix de Revient Kilom√©trique (PRK) Dynamique

Le syst√®me calcule en permanence le PRK instantan√© :

`PRK_dyn = (C_fixe_annuel / KM_annuel_est) + C_variable_km`

- **Co√ªts Fixes (C_fixe_annuel)** : financement (leasing ou amortissement), assurance, frais administratifs, amortis sur le kilom√©trage annuel estim√©.
- **Co√ªts Variables (C_variable_km)** : maintenance, pneumatiques, √©nergie (distinction thermique vs BEV).

### 3.3 La Simulation de Marge en Temps R√©el

Avant validation d'un devis, l'agent IA "Pricing Analyst" simule la marge nette :

`Marge = Prix_Vente - (Dist_Total √ó PRK) - (Temps_Total √ó C_Horaire_Chauffeur) - P√©ages`

`Dist_Total` inclut l'approche (garage ‚Üí client), la course, et le retour √† base. Si la marge projet√©e < 20 %, l'agent alerte, sugg√®re une majoration, ou recommande un refus pour les non-contractuels.

Optimiser la logistique de flotte est crucial : d'o√π la "Garage Logic".

## 4.0 Pilier III : La Logistique Distribu√©e - "Garage Logic" et Optimisation de Route

La rentabilit√© se joue sur l'approche √† vide ("deadhead"). La "Garage Logic" rompt avec le mod√®le centralis√© et d√©centralise la flotte.

### 4.1 Th√©orie du Garage Distribu√© et Graphe de Disponibilit√©

Chaque domicile chauffeur est g√©ocod√© en Garage Virtuel (G_v), transformant la flotte en nuage de ressources dynamiques. L'algorithme "Home Base" (HBO) mon√©tise le "First Mile" : pour la premi√®re course, assignation prioritaire d'un chauffeur proche, si `dist(G_v, R_start) < dist(QG, R_start)`, r√©duisant le co√ªt d'approche.

### 4.2 Le Calcul Strat√©gique du Co√ªt d'Approche (C_app)

Deux r√©alit√©s √©conomiques :

- **C_app_real** : co√ªt TCO r√©el du trajet (G_v ‚Üí pickup), interne.
- **C_app_comm** : co√ªt d'approche factur√©.

Strat√©gie de "Shadow Pricing" :

- **Cas 1 (D√©part Loin)** : client paie l'approche (`C_app_comm ‚âà C_app_real`).
- **Cas 2 (D√©part Proche / Z_0)** : `C_app_comm ‚Üí 0` pour simuler l'omnispresence.

Protection particuliers : si `C_app_real > P_course`, le syst√®me retourne une indisponibilit√© technique.

### 4.3 L'Optimisation d'Itin√©raire par Graphes

Le r√©seau routier est un graphe pond√©r√© (temps, distance, co√ªt √©nerg√©tique, p√©ages). Simulation "Tri-Vectorielle" par requ√™te :

- **Sc√©nario min(T)** (plus rapide) : mod√®le de trafic pr√©dictif pessimiste, mode VIP par d√©faut.
- **Sc√©nario min(D)** (plus court) : distance minimale, utile pour co√ªts planchers.
- **Sc√©nario min(TCO)** (√âco-Optimis√©) : calcule `TCO_route = (T √ó C_horaire) + (D √ó C_km) + C_p√©age + C_√©nergie` pour arbitrer temps vs surco√ªt (ex : "Gagner 4 min justifie-t-il 12‚Ç¨ de p√©age ?").

## 5.0 Pilier IV : L'Architecture "Agent-Native" et la Conformit√© R√©glementaire

La couche cognitive est assur√©e par des agents IA autonomes, rempla√ßant l'intervention manuelle pour la d√©cision et la conformit√© en temps r√©el.

### 5.1 La "Dispatch Squad" : Les Agents IA Sp√©cialis√©s

Neural-Fleet d√©ploie 15 agents orchestr√©s via LangGraph. Quatre agents cl√©s :

- **Agent Watchtower (Live Ops)** : surveille flux GPS, pr√©dit retards, d√©tecte anomalies, propose rem√©diations.
- **Agent Matchmaker (Dispatcher)** : r√©sout VRP, assigne courses selon score pond√©r√© (proximit√©, rentabilit√©, historique).
- **Agent Negotiator (Sales & Pricing)** : g√®re yield, devis complexes (roadshows), multiplicateurs contextuels.
- **Agent Guardian (Compliance)** : gouverneur RSE/LOM, veto sur assignations non conformes avec citation l√©gale.

### 5.2 La "Cage de Fer" : Le Moteur de Conformit√© RSE/LOM

Le "Compliance Engine" intercepte et v√©rifie chaque d√©cision. Les r√®gles RSE sont des contraintes dures, en particulier pour v√©hicules > 9 places.

| R√®gle RSE                   | Param√®tre Technique                    | Action du Validateur                               |
| --------------------------- | -------------------------------------- | -------------------------------------------------- |
| Conduite Journali√®re        | `max_daily_driving = 9h` (10h, 2x/sem) | Bloque toute assignation d√©passant la limite.      |
| Pause 45 min                | `max_continuous_drive = 4.5h`          | Force l'insertion d'un n≈ìud "Pause" de 45 min.     |
| Repos Journalier            | `min_daily_rest = 11h` (ou 9h r√©duit)  | Interdit tout d√©but de mission avant fin du repos. |
| Amplitude Max (1 chauffeur) | `amplitude_max = 14h`                  | Valide que la fin de service respecte l'amplitude. |

#### 5.2.1 Sp√©cificit√©s Fran√ßaises et Loi LOM

Contraintes additionnelles :

- **Travail de Nuit** : d√©tection 21h‚Äì06h, majorations automatiques, v√©rification des limites d'heures.
- **Indemnit√©s de Repas** : calcul automatique des paniers d√®s qu'un chauffeur est en service sur les plages concern√©es et hors base.

#### 5.2.2 Gestion des Missions Complexes : Double √âquipage et Frais de Vie

Pour les longues distances :

- **Double √âquipage** : bascule en mode double √©quipage, amplitude √©tendue √† 18h, rotation des r√¥les pour conformit√© continue.
- **Frais de Vie** : segmentation avec "Coupures Virtuelles" (nuits), interrogation API Places pour h√¥tels, ajout des frais :
  - H√¥tel : 100‚Ç¨ / nuit (jusqu'√† 250‚Ç¨ en zones ch√®res).
  - Repas : 60‚Ç¨ / jour.
  - Prime de D√©coucher : 50‚Ç¨ / nuit.

### 5.3 La Matrice de Pricing Dynamique : Les Multiplicateurs Contextuels

Le prix de base est modul√© par du Yield Management :

- **Surcharges Temporelles** : multiplicateur nuit ~1.25 pour 21h‚Äì06h ; pour courses hybrides, moyenne pond√©r√©e.
- **"Patience Tax"** : multiplicateur li√© au score de difficult√© client \( S_d \) (ex : 1300‚Ç¨ ‚Üí 2200‚Ç¨ pour client exigeant).
- **Saisonnalit√© & √âv√©nementiel** : mode "Scarcity" lors d'√©v√©nements (CDG, Bourget‚Ä¶) avec dur√©es minimales (12h/14h) et multiplicateurs √©lev√©s ; mode "Stimulation" en basse saison avec r√©ductions cibl√©es.

## 6.0 Synth√®se : L'Algorithme Ma√Ætre de Neural-Fleet V4

L'√©quation de pricing unifi√©e g√®re tout le spectre, du transfert a√©roport au roadshow complexe :

`P_Final = (Base(Z_org, Z_dest) ou ùìï(T, D, Z) + C_App_Comm + C_Friction) √ó ‚àè M_Context`

- **Base(Z_org, Z_dest)** : prix forfaitaire de la matrice de co√ªts fixes (prioritaire, ex : contrat B2B).
- **ùìï(T, D, Z)** : fonction de co√ªt dynamique (forfait, bucket temporel, ou horokilom√©trique) selon la topologie.
- **C_App_Comm** : co√ªt d'approche factur√© (pouvant √™tre nul en zone dense).
- **C_Friction** : surcharges topologiques fixes (ex : +60‚Ç¨ pour Versailles).
- **‚àè M_Context** : produit des multiplicateurs dynamiques :
  - \( M\_{Nuit} \) (surcharge horaire)
  - \( M\_{Saison} \) (saisonnalit√© / √©v√©nementiel)
  - \( M\_{VIP} \) (taxe de patience)
  - \( M\_{V√©hicule} \) (cat√©gorie v√©hicule, ex : Van vs Berline)

## 7.0 Conclusion : Vers un Syst√®me d'Exploitation de la Mobilit√©

Neural-Fleet V4 transforme la contrainte g√©ographique et temporelle en opportunit√© de marge. En s'affranchissant des mod√®les lin√©aires obsol√®tes, le syst√®me mod√©lise, anticipe et tarifie la complexit√© urbaine avec pr√©cision.

Avantages strat√©giques :

- Ancrage de chaque prix dans le TCO r√©el de l'actif pour garantir la rentabilit√©.
- Logistique distribu√©e "Garages Virtuels" pour minimiser les co√ªts √† vide.
- Intelligence agent-native pilotant le Yield Management en temps r√©el.

En d√©finitive, Neural-Fleet V4 est un syst√®me d'exploitation de la mobilit√© de luxe, capable d'optimiser des actifs financiers mobiles dans un espace-temps complexe pour que chaque tour de roue contribue positivement et durablement √† la rentabilit√© de l'entreprise.
